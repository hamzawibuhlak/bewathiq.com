# Phase 31: Slug Routing & Multi-Step Registration — Walkthrough

## What Changed

### Backend
| File | Change |
|------|--------|
| [schema.prisma](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/prisma/schema.prisma) | Added `PlanType` enum, `slug` (unique), `planType`, `planStartDate`, `planEndDate` to Tenant |
| [register.dto.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/dto/register.dto.ts) | Added `slug`, `city`, `licenseNumber`, `planType` fields with validation |
| [auth.service.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.service.ts) | New [checkSlugAvailability()](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.service.ts#41-64), updated [register](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.service.ts#31-98)/[login](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.service.ts#154-259)/[getMe](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.controller.ts#55-58)/[generateToken](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.service.ts#357-377) with slug support |
| [auth.controller.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/auth.controller.ts) | New `GET /auth/check-slug/:slug` endpoint |
| [jwt.strategy.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/auth/strategies/jwt.strategy.ts) | `tenantSlug` added to JWT payload |

### Frontend
| File | Change |
|------|--------|
| [types/index.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/types/index.ts) | `Tenant.slug`, `Tenant.planType`, [RegisterRequest](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/types/index.ts#58-69) with slug/city/licenseNumber/planType |
| [auth.store.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/stores/auth.store.ts) | [getTenantSlug()](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/stores/auth.store.ts#94-96) helper, tenant interface with slug+planType |
| [use-auth.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/hooks/use-auth.ts) | Login/register redirect uses `response.redirectTo` → `/:slug/dashboard` |
| [App.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/App.tsx) | All app routes under `/:slug/*`, [SlugRedirect](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/App.tsx#203-211) for backward compat (`/dashboard` → `/:slug/dashboard`) |
| [Sidebar.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/components/layout/Sidebar.tsx) | All nav paths are relative, prepended with `/${slug}/` via `useParams` |
| [Header.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/components/layout/Header.tsx) | Quick actions, settings nav, messages link use slug prefix |
| [Breadcrumbs.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/components/common/Breadcrumbs.tsx) | Home link → `/:slug/dashboard`, slug segment skipped in auto-generated breadcrumbs |
| [OwnerLayout.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/pages/owner/OwnerLayout.tsx) | Back-to-dashboard link → `/:slug/dashboard` |
| [RegisterPage.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/pages/auth/RegisterPage.tsx) | Complete rewrite: 3-step wizard with real-time slug availability check |

## URL Structure

```
Before: /dashboard, /cases, /settings/profile
After:  /watheeq-law/dashboard, /watheeq-law/cases, /watheeq-law/settings/profile
```

## Registration Flow
1. **Step 1** — Office name, slug (with instant availability check), city, license number
2. **Step 2** — Owner name, email, phone, password
3. **Step 3** — Plan selection (Basic/Professional/Enterprise)

## Remaining Steps
- Run `npx prisma generate` + `npx prisma migrate dev` on the server
- Test end-to-end registration and slug routing
