# Phase 22: Communication Hub - Ù…Ø±ÙƒØ² Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„

## Overview
ØªØ­ÙˆÙŠÙ„ Watheeq Ù„Ù…Ø±ÙƒØ² Ø§ØªØµØ§Ù„Ø§Øª Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Call Center Ùˆ Real-time Messaging.

## Proposed Changes

### ğŸ“ Backend - Call Center Module

#### [NEW] [calls.service.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/calls/calls.service.ts)
- Twilio Voice integration
- `initiateCall()` - Ø¥Ø¬Ø±Ø§Ø¡ Ù…ÙƒØ§Ù„Ù…Ø§Øª ØµØ§Ø¯Ø±Ø©
- `handleIncomingCall()` - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
- `generateIVRTwiML()` - Ù†Ø¸Ø§Ù… IVR Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- `getCallHistory()` - Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
- `getCallAnalytics()` - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª

#### [NEW] [calls.controller.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/calls/calls.controller.ts)
- POST `/calls/initiate`
- GET `/calls/history`
- GET `/calls/analytics`
- GET `/calls/:id/recording`

#### [NEW] [twilio.controller.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/webhooks/twilio.controller.ts)
- Webhooks Ù„Ù€ Twilio Voice
- IVR selection handling
- Recording callbacks

---

### ğŸ’¬ Backend - Real-time Messaging Enhancements

#### [MODIFY] [websocket.gateway.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/websocket/websocket.gateway.ts)
- Ø¥Ø¶Ø§ÙØ© events Ù„Ù„Ù€ messaging: `message:send`, `message:typing`, `message:read`
- Ø¥Ø¶Ø§ÙØ© events Ù„Ù„Ù€ groups: `group:join`, `group:message`
- ØªØ­Ø³ÙŠÙ† online/offline status

#### [NEW] [group-chat.service.ts](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/src/messaging/group-chat.service.ts)
- `createGroup()` - Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©
- `addMembers()` - Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡
- `sendGroupMessage()` - Ø±Ø³Ø§Ø¦Ù„ Ø¬Ù…Ø§Ø¹ÙŠØ©

---

### ğŸ—„ï¸ Database - Prisma Schema

#### [MODIFY] [schema.prisma](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/backend/prisma/schema.prisma)
- `Call` model - Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
- `CallRecording` model - ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
- `GroupChat` model - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
- `GroupMember` model - Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
- `GroupMessage` model - Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©

---

### ğŸ¨ Frontend Components

#### [NEW] [ClickToCall.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/components/calls/ClickToCall.tsx)
- Ø§ØªØµØ§Ù„ Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
- Active call dialog
- Call duration timer

#### [NEW] [CallHistoryPage.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/pages/calls/CallHistoryPage.tsx)
- Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
- ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª

#### [NEW] [ChatWindow.tsx](file:///Users/hamzabuhlakq/Downloads/succes-mark/projects-2026/wathiq%20system%20projec/watheeq-mvp/frontend/src/components/messaging/ChatWindow.tsx)
- Real-time chat
- Typing indicators
- Read receipts

---

## Verification Plan

### Automated Tests
```bash
npm run build  # Backend & Frontend
npx prisma migrate dev  # Database migration
```

### Manual Verification
- ØªØ¬Ø±Ø¨Ø© Ø¥Ø¬Ø±Ø§Ø¡ Ù…ÙƒØ§Ù„Ù…Ø© Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù€ WebSocket
- Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙˆØ±ÙŠØ©
